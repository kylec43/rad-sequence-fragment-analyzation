<!DOCTYPE html>
<html>

    <head>
        
        <meta charset="utf-8">
        <title>RAD-Seq</title>
        <%- include('partials/css.ejs') %>
        <%- include('partials/chartjs_scripts.ejs') %>
    </head>

    <body>
        <%- include ('partials/nav.ejs', {page: 'home', user}) %>
        <%- include ('partials/popup_info_properties') %>

        <div class="row">

            <div class="col-lg-5">
                <div class="card rad-card margin-center" id="analysis_card">
                    <div class="rad-card-header">
                        <h3 class="card-title rad-card-text-header">RAD-Seq Fragment Analysis</h3>
                    </div>
                    <hr>
                    <div class="card-body rad-card-body">
                        <p id="error" class="rad-card-error-message text-center display-none"></p>               
                        <form id="analysis_form" name="analysis_form" action="/" method="post">
                            <div class="container-fluid">
                                <p class="rad-input-properties-header">Analysis Properties</p> <a id="icon-question-a" href="#" onclick="showAnalysisInfoPopup()"><div class="icon-question-container"><i class="fas fa-question icon-question"></i></div></a>
                                <hr>
                                <div class="row">
                                    <div class="col">
                                        <div class="form-group">
                                            <label for="enzyme_select">Restriction Enzyme</label>
                                            <div class="input-group">
                                                <select class="form-control" onchange="onSelectEnzyme(this);" name="enzyme_select" id="enzyme_select">
                                                    <option>&lt&ltcustom&gt&gt</option>
                                                    <% for(let i = 0; i < restriction_enzymes.length; i++) { %>
                                                        <option id="<%= restriction_enzymes[i]['id'] %>"><%= restriction_enzymes[i]["name"] %></option>
                                                    <% } %>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-group">
                                            <label for="enzyme_site">Restriction Site</label>
                                            <div class="input-group">
                                                <input class="form-control" id="enzyme_site" name="enzyme_site" type="text" minlength="2" maxlength="8" required>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row display-none" id="secondEnzymeBlock">
                                    <div class="col">
                                        <div class="form-group">
                                            <label for="enzyme_select2">Restriction Enzyme</label>
                                            <div class="input-group">
                                                <select class="form-control" onchange="onSelectEnzyme2(this);" name="enzyme_select2" id="enzyme_select2">
                                                    <option>&lt&ltcustom&gt&gt</option>
                                                    <% for(let i = 0; i < restriction_enzymes.length; i++) { %>
                                                        <option id="<%= restriction_enzymes[i]['id'] %>2"><%= restriction_enzymes[i]["name"] %></option>
                                                    <% } %>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-group">
                                            <label for="enzyme_site">Restriction Site</label>
                                            <div class="input-group">
                                                <input class="form-control" id="enzyme_site2" name="enzyme_site2" type="text" minlength="2" maxlength="8">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <label for="doubleDigest" style="display: flex; align-items: center;">
                                            <input id="doubleDigest" class="rad-checkbox" name="doubleDigest" type="checkbox" onchange="showRestrictionSite2(this)">&nbsp;Double Digest
                                        </label>
                                    </div>
                                </div>
                                <hr>
                                <div class="row">
                                    <div class="col">
                                        <div class="form-group">
                                            <label for="genome_file">Genome File</label>
                                            <div class="input-group">
                                                <input type="file" id="genome_file" required>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <hr>
                                <div class="row">
                                    <div class="col">
                                        <div class="form-group">
                                            <label for="probability">Slice Probability</label>
                                            <div class="input-group">
                                                <input class="form-control" type="number" name="probability" id="probability" step="0.001" value="1.000" min="0.001" max="1.000" onchange="updateToFixed()" required>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <p class="rad-input-properties-header">Graph Properties</p> <a id="icon-question-g" href="#" onclick="showGraphInfoPopup()"><div class="icon-question-container"><i class="fas fa-question icon-question"></i></div></a>
                                <hr>
                                <div class="row">
                                    <div class="col">
                                        <div class="form-group">
                                            <label for="length_distribution">Length Distribution</label>
                                            <div class="input-group">
                                                <input class="form-control" type="number" name="length_distribution" id="length_distribution" step="1" value="50" min="1" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-group">
                                            <label for="graph_range_min">Graph Range Min</label>
                                            <div class="input-group">
                                                <input class="form-control" type="number" name="graph_range_min" id="graph_range_min" step="1" value="1" min="1" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-group">
                                            <label for="graph_range_max">Graph Range Max</label>
                                            <div class="input-group">
                                                <input class="form-control" type="number" name="graph_range_max" id="graph_range_max" step="1" value="1000" min="1" required>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <div class="form-group">
                                            <label for="outlier">Include Outliers</label>
                                            <div class="input-group">
                                                <input class="rad-checkbox" id="outlier" name="outlier" type="checkbox">
                                            </div>
                                        </div>                           
                                    </div>
                                    <div class="col">
                                        <div class="form-group">
                                            <label for="focus_range_min">Focus Range Min</label>
                                            <div class="input-group">
                                                <input class="form-control" type="number" name="focus_range_min" id="focus_range_min" step="1" value="1" min="1" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-group">
                                            <label for="focus_range_max">Focus Range Max</label>
                                            <div class="input-group">
                                                <input class="form-control" type="number" name="focus_range_max" id="focus_range_max" step="1" value="1000" min="1" required>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <hr>
                                <div class="display-none" id="analysis_loading_block">
                                    <div class="progress" id="progress_bar_block">
                                        <div
                                        id="progress_bar"
                                        class="progress-bar"
                                        role="progressbar"
                                        ></div>
                                    </div>
                                    <div class="rad-load-block">
                                        <h5 class="rad-load-label">Analyzing</h5>
                                        <div class="spinner-border" role="status">
                                            <span class="sr-only"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <button class="rad-button margin-center" type="button" onclick="performAnalysis()" id="analysis_button">Get Analysis</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-lg-7 inner-center">
                <hr style="margin-top: 0px;">
                <h3 class="inner-center">Results</h3>
                <hr>
                <div class="container-fluid rad-data-table-container" id="fragment_table_container">
                </div>
                <div class="chart-container">
                    <canvas id="fragment_chart" class="chart-canvas"></canvas>
                </div>
            </div>
        </div>

        <input type="hidden" value="<%= JSON.stringify(restriction_enzymes) %>" id="restriction_enzymes">
        
        <%- include('partials/scripts.ejs') %>
        <script src="js/controller/home.js"></script>
    </body>


</html>